(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    169143,       4011]
NotebookOptionsPosition[    166498,       3924]
NotebookOutlinePosition[    166841,       3939]
CellTagsIndexPosition[    166798,       3936]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Preamble", "Chapter",
 CellChangeTimes->{{3.780771541527303*^9, 3.780771547398859*^9}}],

Cell["\<\
This section contains the program\[CloseCurlyQuote]s pseudocode and a few \
definitions that should only need to be executed once (as long as the \
parameters are not changed).\
\>", "Text",
 CellChangeTimes->{{3.780771585873912*^9, 3.780771622034917*^9}}],

Cell[CellGroupData[{

Cell["Pseudocode", "Section",
 CellChangeTimes->{{3.7803292543397837`*^9, 3.780329256110973*^9}, {
  3.7807721136837177`*^9, 3.7807721151272697`*^9}}],

Cell[CellGroupData[{

Cell["Define the road network.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}}],

Cell[CellGroupData[{

Cell["\<\
The network consists of a square grid of stops, with routes running N/S and \
E/W to define the grid (plus a dummy turnaround loop on each end). Between \
each pair of grid intersections we can also place stops.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.7806789159643526`*^9}, {
  3.780681600251603*^9, 3.7806816134123807`*^9}, {3.780682029623898*^9, 
  3.780682038601019*^9}, {3.7808488461528215`*^9, 3.7808488685825534`*^9}}],

Cell["Each stop is a node, whose coordinates we store.", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.780678938594097*^9}}],

Cell["\<\
We define arcs for each line, with slightly randomized travel times that \
depend on distance plus a constant boarding time.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.780678946325615*^9}, {
  3.780681957166153*^9, 3.780681990746385*^9}}],

Cell["\<\
Stops that are close enough to each other (taxicab distance) are connected by \
walking arcs.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.7806788303897915`*^9}, {3.7806789332048225`*^9, 3.780678933210821*^9}, {
  3.780682076815765*^9, 3.780682088783948*^9}, {3.7809436720285063`*^9, 
  3.780943687989287*^9}}]
}, Open  ]],

Cell["Define population centers and facilities.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806790038531685`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Population centers are placed randomly but somewhat evenly spaced on the grid.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.780679059001484*^9}, {3.7809437109647923`*^9, 3.7809437516738834`*^9}, {
   3.7809556970289965`*^9, 3.780955719983637*^9}}],

Cell["Facilities are placed uniformly at random on the grid.", \
"SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.780679059001484*^9}, {3.7809437109647923`*^9, 3.7809437516738834`*^9}, {
   3.7809556970289965`*^9, 3.780955704891476*^9}}],

Cell["Population centers also receive a random population.", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.780679059001484*^9}, {3.7809437109647923`*^9, 3.7809437593517623`*^9}}],

Cell["\<\
Additional walking arcs are added to connect the new nodes to the network.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791448949413`*^9}, {3.7806868399016275`*^9, 3.780686839909628*^9}, {
   3.78094373966658*^9, 3.780943749040923*^9}}]
}, Open  ]],

Cell["Define OD and fleet sizes.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791520776386`*^9}}],

Cell[CellGroupData[{

Cell["\<\
For each stop, decide the travel demand to all other stops according to a \
gamma distribution based on Euclidean distance.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791963604383`*^9}}],

Cell["\<\
The total outgoing travel demand for a stop should also depend on its \
population. For each stop, determine the nearest population center, and \
equally distribute the center\[CloseCurlyQuote]s population to all of its \
associated stops.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806792946319265`*^9}}],

Cell[TextData[{
 "There should also be an overall scaling factor to adjust the daily traffic \
as a fraction of the overall population (my Chicago data shows that the \
number of daily boardings is approximately ",
 Cell[BoxData[
  FormBox[
   RowBox[{"2", "/", "3"}], TraditionalForm]]],
 " of the total population, but if we are modeling a smaller time period that \
fraction should be much smaller)."
}], "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679686257347*^9}, {3.7809617292180715`*^9, 
   3.780961741597103*^9}}],

Cell["\<\
The fleet sizes of each route should be proportional to the number of people \
using them, which can be quickly modeled by assuming that all of the travel \
demand travels along its shortest path.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806868545819197`*^9}}]
}, Open  ]],

Cell["Evaluate the objective function\[CloseCurlyQuote]s shape.", \
"ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806868700739527`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Pick several pairs of lines at random. For each pair, vary both of the fleet \
sizes within a range and calculate the objective value for each.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.780686940147503*^9}}],

Cell["\<\
Use these results to generate a table of objective values, displayed as an \
array plot, in order to show how rough the objective looks.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806869729809537`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.7807714143939443`*^9, 3.7807714158685155`*^9}}],

Cell["\<\
The parameters defined below can be changed to generate different types of \
example network. Everything below this point should also be re-executed when \
the parameters are updated.\
\>", "Text",
 CellChangeTimes->{{3.780771419110817*^9, 3.780771456481101*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hlines", "=", "5"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
    "number", " ", "of", " ", "grid", " ", "lines", " ", "running", " ", 
     "horizontally"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"vlines", "=", "7"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
    "number", " ", "of", " ", "grid", " ", "lines", " ", "running", " ", 
     "vertically"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"hgap", "=", "0.2"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"distance", " ", "between", " ", "horizontal", " ", "lines", " ", 
     RowBox[{"(", "mi", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"vgap", "=", "0.2"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"distance", " ", "between", " ", "vertical", " ", "lines", " ", 
     RowBox[{"(", "mi", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"jiggle", "=", "0.002"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
    "random", " ", "displacement", " ", "for", " ", "each", " ", "grid", " ", 
     "node", " ", 
     RowBox[{"(", "mi", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"horizon", "=", "60"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"total", " ", "time", " ", "horizon", " ", 
     RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"minbetween", "=", "0"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
    "minimum", " ", "number", " ", "of", " ", "nodes", " ", "to", " ", 
     "place", " ", "between", " ", "grid", " ", "intersections"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"maxbetween", "=", "2"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{
    "maximum", " ", "number", " ", "of", " ", "nodes", " ", "to", " ", 
     "place", " ", "between", " ", "grid", " ", "intersections"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"wspeed", "=", "0.0455"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"pedestrian", " ", "walking", " ", "speed", " ", 
     RowBox[{"(", 
      RowBox[{"mi", "/", "min"}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"minbspeed", "=", "0.3"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"minimum", " ", "bus", " ", "speed", " ", 
     RowBox[{"(", 
      RowBox[{"mi", "/", "min"}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"maxbspeed", "=", "0.5"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"maximum", " ", "bus", " ", "speed", " ", 
     RowBox[{"(", 
      RowBox[{"mi", "/", "min"}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"minbstop", "=", "0.5"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"minimum", " ", "bus", " ", "stop", " ", "time", " ", 
     RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"maxbstop", "=", "0.75"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"maximum", " ", "bus", " ", "stop", " ", "time", " ", 
     RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"minbturnaround", "=", "5"}], ";", 
   RowBox[{"(*", " ", 
    RowBox[{"minimum", " ", "bus", " ", "turnaround", " ", "time", " ", 
     RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"maxbturnaround", "=", "30"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"maximum", " ", "bus", " ", "turnaround", " ", "time", " ", 
    RowBox[{"(", "min", ")"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"facilities", "=", "8"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"number", " ", "of", " ", "facilities"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"populations", "=", "16"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"number", " ", "of", " ", "population", " ", "centers"}], " ", 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"popspace", "=", "0.2"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "minimum", " ", "required", " ", "spacing", " ", "between", " ", 
    "population", " ", "centers", " ", 
    RowBox[{"(", "mi", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"minpop", "=", "1000"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "minimum", " ", "population", " ", "of", " ", "a", " ", "population", " ", 
    "center"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"maxpop", "=", "2500"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "maximum", " ", "population", " ", "of", " ", "a", " ", "population", " ", 
    "center"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"wradius", "=", "0.12"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "distance", " ", "cutoff", " ", "for", " ", "core", " ", "walking", " ", 
    "arcs", " ", 
    RowBox[{"(", 
     RowBox[{"mi", ",", " ", 
      RowBox[{"measured", " ", "as", " ", "taxicab", " ", "distance"}]}], 
     ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"wradius2", "=", "0.25"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "distance", " ", "cutoff", " ", "for", " ", "auxiliary", " ", "walking", 
    " ", "arcs", " ", 
    RowBox[{"(", 
     RowBox[{"mi", ",", " ", 
      RowBox[{"measured", " ", "as", " ", "taxicab", " ", "distance"}]}], 
     ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"wneighbors", "=", "4"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "maximum", " ", "number", " ", "of", " ", "walking", " ", "neighbors", " ",
     "to", " ", "allow"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"tripmean", "=", "2"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"mean", " ", "passenger", " ", "trip", " ", "length", " ", 
    RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"tripsd", "=", "1.25"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"mean", " ", "passenger", " ", "trip", " ", "std", " ", "dev", " ", 
    RowBox[{"(", "min", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"popfrac", "=", "0.3"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "fraction", " ", "of", " ", "population", " ", "that", " ", "uses", " ", 
    "public", " ", "transit", " ", "during", " ", "the", " ", "given", " ", 
    "time", " ", "horizon"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"odjiggle", "=", "2"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "random", " ", "noise", " ", "for", " ", "modeled", " ", "OD", " ", "pair",
     " ", "travel", " ", "demands"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"odfloor", "=", "1"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"travel", " ", "volume", " ", "threshold"}], ",", " ", 
    RowBox[{
    "below", " ", "which", " ", "the", " ", "demand", " ", "is", " ", 
     "ignored"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"bseats", "=", "39"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "number", " ", "of", " ", "seats", " ", "on", " ", "each", " ", "bus"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"bfleet", "=", "100"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "number", " ", "of", " ", "vehicles", " ", "present", " ", "in", " ", 
    "current", " ", "system"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"bmax", "=", "100"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "maximum", " ", "number", " ", "of", " ", "vehicles", " ", "allowed", " ", 
    "in", " ", "problem"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"linemin", "=", "1"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "minimum", " ", "number", " ", "of", " ", "vehicles", " ", "per", " ", 
    "line"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"linemax", "=", "20"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{
   "maximum", " ", "number", " ", "of", " ", "vehicles", " ", "per", " ", 
    "line"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"fare", "=", "2.25"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"boarding", " ", "fare", " ", 
    RowBox[{"(", "$", ")"}]}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7807714685817165`*^9, 3.780771469692157*^9}, {
   3.7807722664852037`*^9, 3.7807723285478315`*^9}, {3.7807723622388773`*^9, 
   3.7807724136701546`*^9}, {3.78084871435122*^9, 3.780848790950302*^9}, 
   3.7808553189388647`*^9, {3.7808554668835506`*^9, 3.78085547840916*^9}, 
   3.7808563896968355`*^9, 3.780856483595828*^9, {3.780856916720811*^9, 
   3.7808569330009212`*^9}, {3.780856989281165*^9, 3.7808570479088755`*^9}, {
   3.780857133645026*^9, 3.780857136792862*^9}, {3.780857191360109*^9, 
   3.7808572266899395`*^9}, {3.7808573219851074`*^9, 3.780857331801365*^9}, {
   3.7808607186237993`*^9, 3.7808608617713127`*^9}, {3.78086801485207*^9, 
   3.780868022792763*^9}, {3.780868625444586*^9, 3.7808686683276653`*^9}, 
   3.7808687167390623`*^9, 3.780868928273485*^9, {3.780868975178445*^9, 
   3.780869029117138*^9}, {3.7808711560911093`*^9, 3.7808711605126915`*^9}, {
   3.780871826919999*^9, 3.78087182838951*^9}, {3.780919353945106*^9, 
   3.780919355858287*^9}, {3.7809194392511005`*^9, 3.7809194602362547`*^9}, {
   3.7809424795783677`*^9, 3.780942531855831*^9}, 3.7809429087480173`*^9, {
   3.780943398100117*^9, 3.7809433982011757`*^9}, 3.780943463525234*^9, {
   3.7809437631608467`*^9, 3.7809437999572124`*^9}, {3.780944128426804*^9, 
   3.780944130208231*^9}, {3.7809548978169203`*^9, 3.780954954102132*^9}, {
   3.7809556529361563`*^9, 3.780955655300378*^9}, {3.7809572060161886`*^9, 
   3.780957286426631*^9}, {3.7809600091985383`*^9, 3.780960031317463*^9}, 
   3.780960062558426*^9, 3.7809603584370627`*^9, {3.7809604349608607`*^9, 
   3.7809604491683054`*^9}, {3.78096055718265*^9, 3.780960585183673*^9}, {
   3.781009447658851*^9, 3.781009450770296*^9}, 3.7810095429309545`*^9, {
   3.7810095953263674`*^9, 3.781009598897485*^9}, {3.7810107937042007`*^9, 
   3.7810107957861757`*^9}, {3.7810115227225223`*^9, 
   3.7810115779611545`*^9}, {3.7810144668674707`*^9, 3.781014555418959*^9}, {
   3.781021911321941*^9, 3.7810219179143763`*^9}, {3.781022006406988*^9, 
   3.781022019979051*^9}, {3.7810220870844736`*^9, 3.7810220920483017`*^9}, {
   3.781022136700799*^9, 3.7810221586987467`*^9}, 3.7810242811723967`*^9, 
   3.781025843944352*^9, {3.781026486109403*^9, 3.7810264895588293`*^9}, 
   3.781026533341668*^9, {3.7810267248091764`*^9, 3.7810267248731766`*^9}, {
   3.7810267823857317`*^9, 3.781026794780738*^9}, {3.7810269293668833`*^9, 
   3.7810269294878497`*^9}, {3.781029403505779*^9, 3.781029425451626*^9}, {
   3.7810300705419583`*^9, 3.781030150675523*^9}, 3.7810303712836375`*^9, 
   3.781215050151699*^9, 3.7812152277791834`*^9, {3.7812152606319723`*^9, 
   3.7812152635091543`*^9}, {3.7812153196418*^9, 3.781215335208852*^9}, {
   3.781215390410019*^9, 3.7812153920804825`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Section",
 CellChangeTimes->{{3.7809609444987016`*^9, 3.780960945520376*^9}}],

Cell["\<\
The following functions should only need to be defined when the above \
parameters are changed.\
\>", "Text",
 CellChangeTimes->{{3.780960947868601*^9, 3.7809609775890903`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"gamma", "[", "x_", "]"}], ":=", 
    RowBox[{
     SuperscriptBox["x", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox["tripmean", "2"], "-", 
         SuperscriptBox["tripsd", "2"]}], ")"}], "/", 
       SuperscriptBox["tripsd", "2"]}]], 
     SuperscriptBox["E", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"(", 
         RowBox[{"tripmean", "/", 
          SuperscriptBox["tripsd", "2"]}], ")"}]}], "x"}]]}]}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "gamma", " ", "distribution", " ", "of", " ", "trip", " ", "length", " ", 
    "probabilities"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7809609812489176`*^9, 3.7809610158078156`*^9}}],

Cell[" ", "Text",
 Editable->False,
 Selectable->False,
 CellFrame->{{0, 0}, {0, 0.5}},
 ShowCellBracket->False,
 CellMargins->{{0, 0}, {1, 1}},
 CellElementSpacings->{"CellMinHeight"->1},
 CellFrameMargins->0,
 CellFrameColor->RGBColor[0, 0, 1],
 CellSize->{Inherited, 3}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Execution", "Chapter",
 CellChangeTimes->{{3.780771565651047*^9, 3.780771567477462*^9}}],

Cell["\<\
The contents of the following sections may need to be repeatedly re-executed \
to generate satisfactory example networks. They should always be executed in \
order from top to bottom.\
\>", "Text",
 CellChangeTimes->{{3.7807716306375384`*^9, 3.780771649293496*^9}, {
  3.7808685835746193`*^9, 3.7808686061162567`*^9}}],

Cell[CellGroupData[{

Cell["Network Construction", "Section",
 CellChangeTimes->{{3.780771521038786*^9, 3.7807715235126934`*^9}, {
  3.7807720128307896`*^9, 3.7807720163927107`*^9}}],

Cell["\<\
This section builds the underlying network of stops and other locations, \
along with the line arcs and walking arcs to connect them. A map of the \
network is shown once this process is complete.\
\>", "Text",
 CellChangeTimes->{{3.78077198108607*^9, 3.7807720376299205`*^9}, {
  3.7807720965858326`*^9, 3.7807721011810923`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Initialize", " ", "data", " ", "structures"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ncoords", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "node", " ", "coordinates"}], " ", "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ntype", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "node", " ", "types", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"0", " ", "for", " ", "stop"}], ",", " ", 
       RowBox[{"1", " ", "for", " ", "boarding"}], ",", " ", 
       RowBox[{"2", " ", "for", " ", "population"}], ",", " ", 
       RowBox[{"3", " ", "for", " ", "facility"}]}], ")"}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"stops", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"subset", " ", "of", " ", "stop", " ", "node", " ", "IDs"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nname", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "node", " ", "names"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nline", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "boarding", " ", "node", " ", "line", " ", 
     "IDs"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nval", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "node", " ", "values", " ", 
     RowBox[{"(", 
      RowBox[{
      "population", " ", "or", " ", "facility", " ", "weight", " ", "as", " ",
        "applicable"}], ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nrows", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "lists", " ", "of", " ", "boarding", " ", "node", 
     " ", "IDs", " ", "for", " ", "each", " ", "street", " ", "row"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ncols", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "lists", " ", "of", " ", "boarding", " ", "node", 
     " ", "IDs", " ", "for", " ", "each", " ", "street", " ", "column"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"arcs", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"list", " ", "of", " ", "arcs"}], ",", " ", 
     RowBox[{"in", " ", Cell["i\[DirectedEdge]j"], " ", "format"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"atype", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "arc", " ", "types", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"0", " ", "for", " ", "line"}], ",", " ", 
       RowBox[{"1", " ", "for", " ", "boarding"}], ",", " ", 
       RowBox[{"2", " ", "for", " ", "alighting"}], ",", " ", 
       RowBox[{"3", " ", "for", " ", "core", " ", "walking"}], ",", " ", 
       RowBox[{"4", " ", "for", " ", "accessibility", " ", "walking"}]}], 
      ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"acost", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"list", " ", "of", " ", "arc", " ", "times"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"alines", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "lists", " ", "of", " ", "line", " ", "arc", " ", 
     "IDs", " ", "for", " ", "each", " ", "transit", " ", "line"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"alid", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "line", " ", "IDs", " ", "for", " ", "each", " ", 
     "arc"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"linecost", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "total", " ", "travel", " ", "times", " ", "for", 
     " ", "each", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Dimensions (mi): \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"hlines", "-", "1"}], ")"}], " ", "hgap"}], "]"}], "<>", 
     "\"\< \[Times] \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"vlines", "-", "1"}], ")"}], " ", "vgap"}], "]"}]}], "]"}], 
   RowBox[{"(*", " ", 
    RowBox[{"display", " ", "dimensions", " ", "of", " ", "network"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Print", "[", 
    RowBox[{"\"\<Lines: \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"hlines", "+", "vlines"}], "]"}]}], "]"}], 
   RowBox[{"(*", " ", 
    RowBox[{"display", " ", "number", " ", "of", " ", "routes"}], " ", "*)"}],
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Generate", " ", "grid", " ", "intersection", " ", "stops"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ncoords", "=", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"vgap", " ", "j"}], ",", 
            RowBox[{"hgap", " ", "i"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "0", ",", 
            RowBox[{"hlines", "-", "1"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "0", ",", 
            RowBox[{"vlines", "-", "1"}]}], "}"}]}], "]"}], ",", "1"}], "]"}],
       "+", 
      RowBox[{"RandomReal", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "jiggle"}], ",", "jiggle"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"hlines", " ", "vlines"}], ",", "2"}], "}"}]}], "]"}]}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Insert", " ", "additional", " ", "stops", " ", "between", " ", "grid", 
     " ", "intersections", " ", "and", " ", "build", " ", "up", " ", "the", 
     " ", 
     RowBox[{"row", "/", "column"}], " ", "lists"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"col", ",", "row", ",", "inc"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "column", " ", "from", " ", "bottom", 
          " ", "to", " ", "top"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"col", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "node", " ", "IDs", " ", "in", " ", "current", " ", "column"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"col", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"col", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "-", "1"}], ")"}], "+", 
                 RowBox[{"vlines", " ", 
                  RowBox[{"(", 
                   RowBox[{"j", "-", "1"}], ")"}]}], "+", "1"}]}], "]"}]}], 
             ";", 
             RowBox[{"(*", " ", 
              RowBox[{"current", " ", "node", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"btw", "=", 
              RowBox[{"RandomInteger", "[", 
               RowBox[{"{", 
                RowBox[{"minbetween", ",", "maxbetween"}], "}"}], "]"}]}], 
             ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "number", " ", "of", " ", "stops", " ", "to", " ", "insert"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"inc", "=", 
              RowBox[{"N", "[", 
               FractionBox["hgap", 
                RowBox[{"btw", "+", "1"}]], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "distance", " ", "north", " ", "of", " ", "current", " ", 
               "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "insert", " ", "stops", " ", "between", " ", "consecutive", 
                " ", "intersections"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ncoords", "=", 
                 RowBox[{"Append", "[", 
                  RowBox[{"ncoords", ",", 
                   RowBox[{
                    RowBox[{"ncoords", "[", 
                    RowBox[{"[", 
                    RowBox[{"(", 
                    RowBox[{"col", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], ")"}], "]"}], "]"}], 
                    "+", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "inc"}], "}"}], "+", 
                    RowBox[{"RandomReal", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"-", "jiggle"}], ",", "jiggle"}], "}"}], ",", 
                    "2"}], "]"}]}]}], "]"}]}], ";", 
                RowBox[{"(*", " ", 
                 RowBox[{"new", " ", "stop", " ", "coordinate"}], " ", "*)"}],
                 "\[IndentingNewLine]", 
                RowBox[{"col", "=", 
                 RowBox[{"Append", "[", 
                  RowBox[{"col", ",", 
                   RowBox[{"Length", "[", "ncoords", "]"}]}], "]"}]}]}], 
               RowBox[{"(*", " ", 
                RowBox[{
                "add", " ", "new", " ", "entry", " ", "to", " ", "column", 
                 " ", "list"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "btw"}], "}"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"hlines", "-", "1"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "topmost", " ", "stop", " ", "requires", " ", "separate", " ", 
            "processing"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"col", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"col", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"i", "-", "1"}], ")"}], "+", 
              RowBox[{"vlines", " ", 
               RowBox[{"(", 
                RowBox[{"hlines", "-", "1"}], ")"}]}], "+", "1"}]}], "]"}]}], 
          ";", 
          RowBox[{"(*", " ", 
           RowBox[{"top", " ", "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"ncols", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"ncols", ",", "col"}], "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "all", " ", "stops", " ", "in", " ", "column", " ", 
           "to", " ", "main", " ", "column", " ", "list"}], " ", "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "vlines"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "row", " ", "from", " ", "left", " ", 
          "to", " ", "right"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"row", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "node", " ", "IDs", " ", "in", " ", "current", " ", "row"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"row", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"row", ",", 
                RowBox[{
                 RowBox[{"vlines", 
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}]}], "+", 
                 RowBox[{"(", 
                  RowBox[{"j", "-", "1"}], ")"}], "+", "1"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"current", " ", "node", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"btw", "=", 
              RowBox[{"RandomInteger", "[", 
               RowBox[{"{", 
                RowBox[{"minbetween", ",", "maxbetween"}], "}"}], "]"}]}], 
             ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "number", " ", "of", " ", "stops", " ", "to", " ", "insert"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"inc", "=", 
              RowBox[{"N", "[", 
               FractionBox["vgap", 
                RowBox[{"btw", "+", "1"}]], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "distance", " ", "east", " ", "of", " ", "current", " ", 
               "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "insert", " ", "stops", " ", "between", " ", "consecutive", 
                " ", "intersections"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ncoords", "=", 
                 RowBox[{"Append", "[", 
                  RowBox[{"ncoords", ",", 
                   RowBox[{
                    RowBox[{"ncoords", "[", 
                    RowBox[{"[", 
                    RowBox[{"(", 
                    RowBox[{"row", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}], ")"}], "]"}], "]"}], 
                    "+", 
                    RowBox[{"{", 
                    RowBox[{"inc", ",", "0"}], "}"}]}]}], "]"}]}], ";", 
                RowBox[{"(*", " ", 
                 RowBox[{"new", " ", "stop", " ", "coordinate"}], " ", "*)"}],
                 "\[IndentingNewLine]", 
                RowBox[{"row", "=", 
                 RowBox[{"Append", "[", 
                  RowBox[{"row", ",", 
                   RowBox[{"Length", "[", "ncoords", "]"}]}], "]"}]}]}], 
               RowBox[{"(*", " ", 
                RowBox[{
                "add", " ", "new", " ", "entry", " ", "to", " ", "row", " ", 
                 "list"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", "btw"}], "}"}]}], "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"vlines", "-", "1"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "rightmost", " ", "stop", " ", "requires", " ", "separate", " ", 
            "processing"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"row", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"row", ",", 
             RowBox[{"vlines", " ", "i"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"right", " ", "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"nrows", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"nrows", ",", "row"}], "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "all", " ", "stops", " ", "in", " ", "row", " ", "to", 
           " ", "main", " ", "row", " ", "list"}], " ", "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "hlines"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"generate", " ", "node", " ", "attributes"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ntype", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Length", "[", "ncoords", "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"stops", " ", "are", " ", "type", " ", "0"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"nline", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", 
          RowBox[{"Length", "[", "ncoords", "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "stops", " ", "have", " ", "no", " ", "associated", " ", "lines"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"nname", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<Stop\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"i", "-", "1"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "stop", " ", "nodes", " ", "are", " ", "named", " ", "according", " ",
          "to", " ", "their", " ", "node", " ", "IDs"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"stops", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "all", " ", "nodes", " ", "so", " ", "far", " ", "are", " ", 
         "stops"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Stops: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Length", "[", "ncoords", "]"}], "]"}]}], "]"}], ";"}]}], 
     RowBox[{"(*", " ", 
      RowBox[{"print", " ", "number", " ", "of", " ", "stops"}], " ", "*)"}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Define", " ", "boarding", " ", "nodes", " ", "and", " ", "associated", 
     " ", 
     RowBox[{"boarding", "/", "alighting"}], " ", "arcs", " ", "for", " ", 
     "each", " ", "column", " ", "and", " ", "row"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"old", ",", "new"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "column", " ", "from", " ", "bottom", 
          " ", "to", " ", "top"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"old", "=", 
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "node", " ", "ID", " ", "of", " ", "current", " ", "stop"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"new", "=", 
              RowBox[{
               RowBox[{"Length", "[", "ncoords", "]"}], "+", "1"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "node", " ", "ID", " ", "of", " ", "new", " ", "boarding", " ", 
               "node"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"ncoords", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"ncoords", ",", 
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "old", "]"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "node", " ", "gets", " ", "same", " ", 
               "coordinates", " ", "as", " ", "stop"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"nname", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"nname", ",", 
                RowBox[{
                 RowBox[{"nname", "[", 
                  RowBox[{"[", "old", "]"}], "]"}], "<>", "\"\<_Route\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}]}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "append", " ", "line", " ", "ID", " ", "to", " ", "boarding", 
               " ", "node", " ", "name"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"nline", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"nline", ",", "i"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "node", " ", "associated", " ", "with", " ", 
               "current", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"ntype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"ntype", ",", "1"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "nodes", " ", "are", " ", "type", " ", "1"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"arcs", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"arcs", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"old", "\[DirectedEdge]", "new"}], ",", 
                  RowBox[{"new", "\[DirectedEdge]", "old"}]}], "}"}]}], 
               "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "add", " ", "boarding", " ", "and", " ", "alighting", " ", 
               "arcs"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"acost", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "and", " ", "alighting", " ", "base", " ", 
               "times", " ", "both", " ", "0"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"atype", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"boarding", " ", "type", " ", "1"}], ",", " ", 
               RowBox[{"alighting", " ", "type", " ", "2"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
              RowBox[{"Length", "[", "ncoords", "]"}]}], ";"}], 
            RowBox[{"(*", " ", 
             RowBox[{
             "replace", " ", "line", " ", "node", " ", "ID", " ", "with", " ",
               "the", " ", "new", " ", "node", " ", "for", " ", "later", " ", 
              "use"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"(", 
                RowBox[{"ncols", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}]}], "}"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"alid", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"alid", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"i", ",", 
               RowBox[{"2", 
                RowBox[{"Length", "[", 
                 RowBox[{"(", 
                  RowBox[{"ncols", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}]}]}], "]"}]}], 
            "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{"line", " ", "ID", " ", "for", " ", 
           RowBox[{"boarding", "/", "alighting"}], " ", "arcs"}], " ", "*)"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "vlines"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "row", " ", "from", " ", "left", " ", 
          "to", " ", "right"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"old", "=", 
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "node", " ", "ID", " ", "of", " ", "current", " ", "stop"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"new", "=", 
              RowBox[{
               RowBox[{"Length", "[", "ncoords", "]"}], "+", "1"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "node", " ", "ID", " ", "of", " ", "new", " ", "boarding", " ", 
               "node"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"ncoords", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"ncoords", ",", 
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "old", "]"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "node", " ", "gets", " ", "same", " ", 
               "coordinates", " ", "as", " ", "stop"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"nname", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"nname", ",", 
                RowBox[{
                 RowBox[{"nname", "[", 
                  RowBox[{"[", "old", "]"}], "]"}], "<>", "\"\<_Route\>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"i", "-", "1"}], "]"}]}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "append", " ", "line", " ", "ID", " ", "to", " ", "boarding", 
               " ", "node", " ", "name"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"nline", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"nline", ",", 
                RowBox[{"vlines", "+", "i"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "node", " ", "associated", " ", "with", " ", 
               "current", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"ntype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"ntype", ",", "1"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "nodes", " ", "are", " ", "type", " ", "1"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"arcs", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"arcs", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"old", "\[DirectedEdge]", "new"}], ",", 
                  RowBox[{"new", "\[DirectedEdge]", "old"}]}], "}"}]}], 
               "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "add", " ", "boarding", " ", "and", " ", "alighting", " ", 
               "arcs"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"acost", ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "boarding", " ", "and", " ", "alighting", " ", "base", " ", 
               "times", " ", "both", " ", "0"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"atype", ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"boarding", " ", "type", " ", "1"}], ",", " ", 
               RowBox[{"alighting", " ", "type", " ", "2"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
              RowBox[{"Length", "[", "ncoords", "]"}]}], ";"}], 
            RowBox[{"(*", " ", 
             RowBox[{
             "replace", " ", "line", " ", "node", " ", "ID", " ", "with", " ",
               "the", " ", "new", " ", "node", " ", "for", " ", "later", " ", 
              "use"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"(", 
                RowBox[{"nrows", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}]}], "}"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"alid", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"alid", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{"vlines", "+", "i"}], ",", 
               RowBox[{"2", 
                RowBox[{"Length", "[", 
                 RowBox[{"(", 
                  RowBox[{"nrows", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}]}]}], "]"}]}], 
            "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{"line", " ", "ID", " ", "for", " ", 
           RowBox[{"boarding", "/", "alighting"}], " ", "arcs"}], " ", "*)"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "hlines"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"nval", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"-", "1"}], ",", 
          RowBox[{"Length", "[", "ncoords", "]"}]}], "]"}]}], ";"}]}], 
     RowBox[{"(*", " ", 
      RowBox[{
      "stop", " ", "and", " ", "boarding", " ", "nodes", " ", "have", " ", 
       "no", " ", "values"}], " ", "*)"}], "\[IndentingNewLine]", "]"}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Define", " ", "line", " ", "arcs", " ", "for", " ", "each", " ", 
     "column", " ", "and", " ", "row"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"head", ",", "tail", ",", "line", ",", "d", ",", "t"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "column", " ", "and", " ", "generate", 
          " ", "arcs", " ", "between", " ", "each", " ", "consecutive", " ", 
          "pair", " ", "of", " ", "stops"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"line", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"current", " ", "transit", " ", 
            RowBox[{"line", "'"}], "s", " ", "arcs"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"linecost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"linecost", ",", 
             RowBox[{"{", "}"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "initialize", " ", "an", " ", "empty", " ", "line", " ", "cost", 
            " ", "list"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"tail", "=", 
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"tail", " ", "stop", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"head", "=", 
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"head", " ", "stop", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"d", "=", 
              RowBox[{"EuclideanDistance", "[", 
               RowBox[{
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "tail", "]"}], "]"}], ",", 
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "head", "]"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"link", " ", "distance"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"minbstop", ",", "maxbstop"}], "}"}], "]"}], "+", 
               RowBox[{"d", "/", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"minbspeed", ",", "maxbspeed"}], "}"}], "]"}]}]}]}],
              ";", 
             RowBox[{"(*", " ", 
              RowBox[{"link", " ", "time"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"acost", ",", "t"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"atype", ",", "0"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"line", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"line", ",", 
                RowBox[{"tail", "\[DirectedEdge]", "head"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "append", " ", "arc", " ", "to", " ", "line", " ", "list"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"also", " ", "generate", " ", "revese", " ", "arc"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"minbstop", ",", "maxbstop"}], "}"}], "]"}], "+", 
               RowBox[{"d", "/", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"minbspeed", ",", "maxbspeed"}], "}"}], "]"}]}]}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"acost", ",", "t"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"atype", ",", "0"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"line", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"line", ",", 
                RowBox[{"head", "\[DirectedEdge]", "tail"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"linecost", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"linecost", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], ",", "t"}], "]"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"ncols", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}],
            "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "add", " ", "turnaround", " ", "loops", " ", "to", " ", 
            "endpoints"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"t", "=", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"{", 
             RowBox[{"minbturnaround", ",", "maxbturnaround"}], "}"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"line", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"line", ",", 
             RowBox[{
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[DirectedEdge]", 
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"acost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"acost", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"linecost", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], "=", 
           RowBox[{"Append", "[", 
            RowBox[{
             RowBox[{"linecost", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "t"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"t", "=", 
           RowBox[{"RandomReal", "[", 
            RowBox[{"{", 
             RowBox[{"minbturnaround", ",", "maxbturnaround"}], "}"}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"line", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"line", ",", 
             RowBox[{
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "\[DirectedEdge]", 
              RowBox[{"ncols", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"acost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"acost", ",", "t"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"linecost", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], "=", 
           RowBox[{"Append", "[", 
            RowBox[{
             RowBox[{"linecost", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}], ",", "t"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"atype", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"atype", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"arcs", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"arcs", ",", "line"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "add", " ", "arcs", " ", "to", " ", "main", " ", "arc", " ", 
            "list"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"alid", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"alid", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "[", "line", "]"}]}], "]"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"line", " ", "ID"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"alines", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"alines", ",", "line"}], "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "line", " ", "arcs", " ", "to", " ", "line", " ", "arc",
            " ", "list"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "ncols", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "row", " ", "and", " ", "generate", " ",
           "arcs", " ", "between", " ", "each", " ", "consecutive", " ", 
          "pair", " ", "of", " ", "stops"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"line", "=", 
           RowBox[{"{", "}"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"current", " ", "transit", " ", 
            RowBox[{"line", "'"}], "s", " ", "arcs"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"linecost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"linecost", ",", 
             RowBox[{"{", "}"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "initialize", " ", "an", " ", "empty", " ", "line", " ", "cost", 
            " ", "list"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"tail", "=", 
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"tail", " ", "stop", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"head", "=", 
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"head", " ", "stop", " ", "ID"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"d", "=", 
              RowBox[{"EuclideanDistance", "[", 
               RowBox[{
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "tail", "]"}], "]"}], ",", 
                RowBox[{"ncoords", "[", 
                 RowBox[{"[", "head", "]"}], "]"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"link", " ", "distance"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"minbstop", ",", "maxbstop"}], "}"}], "]"}], "+", 
               RowBox[{"d", "/", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"minbspeed", ",", "maxbspeed"}], "}"}], "]"}]}]}]}],
              ";", 
             RowBox[{"(*", " ", 
              RowBox[{"link", " ", "time"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"acost", ",", "t"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"atype", ",", "0"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"line", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"line", ",", 
                RowBox[{"tail", "\[DirectedEdge]", "head"}]}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "append", " ", "arc", " ", "to", " ", "line", " ", "list"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"also", " ", "generate", " ", "revese", " ", "arc"}], 
              " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"minbstop", ",", "maxbstop"}], "}"}], "]"}], "+", 
               RowBox[{"d", "/", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"minbspeed", ",", "maxbspeed"}], "}"}], "]"}]}]}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"acost", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"acost", ",", "t"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"atype", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"atype", ",", "0"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"line", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"line", ",", 
                RowBox[{"head", "\[DirectedEdge]", "tail"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"linecost", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}], "=", 
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"linecost", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}], ",", "t"}], "]"}]}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"nrows", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}],
            "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "add", " ", "turnaround", " ", "loops", " ", "to", " ", 
            "endpoints"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"line", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"line", ",", 
             RowBox[{
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], "\[DirectedEdge]", 
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"acost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"acost", ",", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"minbturnaround", ",", "maxbturnaround"}], "}"}], 
              "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"line", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"line", ",", 
             RowBox[{
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}], "\[DirectedEdge]", 
              RowBox[{"nrows", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"acost", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"acost", ",", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"minbturnaround", ",", "maxbturnaround"}], "}"}], 
              "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"atype", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"atype", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"arcs", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"arcs", ",", "line"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "add", " ", "arcs", " ", "to", " ", "main", " ", "arc", " ", 
            "list"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"alid", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"alid", ",", 
             RowBox[{"ConstantArray", "[", 
              RowBox[{
               RowBox[{"vlines", "+", "i"}], ",", 
               RowBox[{"Length", "[", "line", "]"}]}], "]"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"line", " ", "ID"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"alines", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"alines", ",", "line"}], "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "add", " ", "line", " ", "arcs", " ", "to", " ", "line", " ", "arc",
            " ", "list"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "nrows", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Generate", " ", "core", " ", "walking", " ", "arcs"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d", ",", "t", ",", "a", ",", "b"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "process", " ", "each", " ", "unique", " ", "pair", " ", "of", " ",
             "stop", " ", "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"a", "=", 
             RowBox[{"stops", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"b", "=", 
             RowBox[{"stops", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"d", "=", 
             RowBox[{"ManhattanDistance", "[", 
              RowBox[{
               RowBox[{"ncoords", "[", 
                RowBox[{"[", "a", "]"}], "]"}], ",", 
               RowBox[{"ncoords", "[", 
                RowBox[{"[", "b", "]"}], "]"}]}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"pairwise", " ", "distance"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"t", "=", 
             RowBox[{"N", "[", 
              RowBox[{"d", "/", "wspeed"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"walking", " ", "time"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"d", "\[LessEqual]", "wradius"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "connect", " ", "nearby", " ", "pairs", " ", "of", " ", "arcs",
                 " ", "with", " ", "walking", " ", "arcs"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
                     "**", "**", "**", "**", "**", "**", "**", "**"}], "**"}],
                     "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
               "*******)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "add", " ", "quadrangle", " ", "check", " ", "if", " ", 
                "there", " ", "are", " ", "too", " ", "many", " ", "walking", 
                " ", "arcs"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "**", "**", "**", "**", "**", "**", "**", "**", "**", "**",
                     "**", "**", "**", "**", "**", "**", "**", "**"}], "**"}],
                     "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
                "**"}], "*****)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"arcs", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"arcs", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"a", "\[DirectedEdge]", "b"}], ",", 
                    RowBox[{"b", "\[DirectedEdge]", "a"}]}], "}"}]}], "]"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"atype", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"atype", ",", 
                  RowBox[{"{", 
                   RowBox[{"3", ",", "3"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"acost", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"acost", ",", 
                  RowBox[{"{", 
                   RowBox[{"t", ",", "t"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"alid", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{"alid", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Nodes: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"Length", "[", "ncoords", "]"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Arcs: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{"Length", "[", "arcs", "]"}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Display", " ", "map", " ", "for", " ", "review"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"as", "=", 
       RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "pick", " ", "subset", " ", "of", " ", "arcs", " ", "that", " ", 
          "are", " ", "not", " ", "boarding", " ", "or", " ", "alighting"}], 
         ",", " ", 
         RowBox[{
         "since", " ", "otherwise", " ", "Mathematica", " ", "will", " ", 
          "have", " ", "trouble", " ", "drawing", " ", "things"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"atype", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "1"}], "&&", 
           RowBox[{
            RowBox[{"atype", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "2"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"as", "=", 
            RowBox[{"Append", "[", 
             RowBox[{"as", ",", 
              RowBox[{"arcs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "arcs", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Graph", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{"i", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}], ",", 
        "as", ",", 
        RowBox[{"VertexCoordinates", "\[Rule]", "ncoords"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.780839107164124*^9, 3.78083915348427*^9}, {
   3.7808529886701245`*^9, 3.7808530833436728`*^9}, {3.7808532037302055`*^9, 
   3.780853280910163*^9}, {3.780853317178815*^9, 3.7808533879777718`*^9}, {
   3.780853457168648*^9, 3.780853462433568*^9}, {3.78085356463711*^9, 
   3.780853633072615*^9}, {3.7808537304724464`*^9, 3.7808537380353975`*^9}, {
   3.7808538342490177`*^9, 3.7808538483777637`*^9}, {3.7808539124666233`*^9, 
   3.7808540575509076`*^9}, {3.7808542572469563`*^9, 
   3.7808543096302524`*^9}, {3.780854347862917*^9, 3.780854474240201*^9}, {
   3.7808545115873165`*^9, 3.780854676307379*^9}, {3.7808548632547855`*^9, 
   3.780855014481696*^9}, {3.7808550843718786`*^9, 3.7808552769123116`*^9}, {
   3.7808553967967243`*^9, 3.780855413977216*^9}, {3.7808555774179783`*^9, 
   3.7808557301665*^9}, {3.780855790665188*^9, 3.7808557935957537`*^9}, {
   3.780855835671893*^9, 3.7808558645704603`*^9}, {3.7808559930741315`*^9, 
   3.7808560790618153`*^9}, {3.780856323980884*^9, 3.7808563246606684`*^9}, 
   3.780856465052816*^9, {3.780856548882295*^9, 3.780856584267805*^9}, {
   3.780856615003056*^9, 3.780856901788807*^9}, {3.7808603019389634`*^9, 
   3.780860317156128*^9}, {3.78086035170458*^9, 3.78086038148343*^9}, {
   3.780860428991516*^9, 3.780860435457353*^9}, {3.7808604658149304`*^9, 
   3.78086050952096*^9}, {3.780860556421887*^9, 3.7808606160477905`*^9}, {
   3.7808606648544044`*^9, 3.780860710540225*^9}, {3.780860907399638*^9, 
   3.780860960083744*^9}, {3.7808609923943844`*^9, 3.780861002268216*^9}, {
   3.7808614083266163`*^9, 3.780861415731242*^9}, {3.7808674488267255`*^9, 
   3.7808674560002527`*^9}, {3.780867493857787*^9, 3.7808676378360806`*^9}, {
   3.7808677987501717`*^9, 3.7808678212702827`*^9}, {3.780867862227934*^9, 
   3.780867949501*^9}, {3.780868092313163*^9, 3.7808681093402576`*^9}, {
   3.780868186979131*^9, 3.780868217424326*^9}, {3.7808682729425497`*^9, 
   3.7808682735362525`*^9}, {3.780868358326125*^9, 3.780868420683856*^9}, {
   3.7808684585427685`*^9, 3.780868460139039*^9}, {3.7808687409260263`*^9, 
   3.7808687757503734`*^9}, {3.780868880625744*^9, 3.780868892893831*^9}, {
   3.780870935900695*^9, 3.7808710452466536`*^9}, {3.7809379375807977`*^9, 
   3.780937944736589*^9}, {3.7809381246671114`*^9, 3.780938187174043*^9}, {
   3.7809382591772165`*^9, 3.780938273790532*^9}, {3.7809383131739025`*^9, 
   3.780938356850897*^9}, {3.780939093467409*^9, 3.780939156819725*^9}, {
   3.7809392695848837`*^9, 3.7809393582053614`*^9}, {3.780939412961711*^9, 
   3.7809394631992383`*^9}, {3.780939558499921*^9, 3.780939642310735*^9}, {
   3.780939687843705*^9, 3.780939845176283*^9}, {3.780939888064414*^9, 
   3.780939928888777*^9}, {3.780939960397353*^9, 3.780940042330708*^9}, {
   3.780940166953786*^9, 3.780940206268397*^9}, {3.7809403054776125`*^9, 
   3.780940337977317*^9}, {3.780940441724405*^9, 3.7809407261527357`*^9}, {
   3.780940757703644*^9, 3.7809408016025276`*^9}, {3.7809409322198887`*^9, 
   3.7809409545637765`*^9}, {3.7809410004309034`*^9, 3.780941042994712*^9}, {
   3.780941082960945*^9, 3.7809410842868834`*^9}, {3.7809411692697725`*^9, 
   3.7809412842611666`*^9}, {3.7809416744128065`*^9, 3.780941696531839*^9}, {
   3.780941779338462*^9, 3.780941917628172*^9}, {3.78094200829214*^9, 
   3.780942129527347*^9}, {3.780942580807846*^9, 3.7809425990240946`*^9}, {
   3.7809426328270593`*^9, 3.7809426707548046`*^9}, {3.7809427052657795`*^9, 
   3.7809428876126966`*^9}, {3.7809429489153614`*^9, 3.780943001438075*^9}, {
   3.780943060075363*^9, 3.780943133199129*^9}, {3.7809431653992753`*^9, 
   3.7809433315531816`*^9}, {3.780943537733862*^9, 3.7809435634317427`*^9}, {
   3.7809447941333475`*^9, 3.7809447965221615`*^9}, {3.780944966018447*^9, 
   3.780944973587921*^9}, {3.7810246509921923`*^9, 3.7810246997591066`*^9}, {
   3.7810247322297945`*^9, 3.781024918768276*^9}, {3.7810347285011454`*^9, 
   3.781034844509968*^9}, {3.781034878293334*^9, 3.7810349010458746`*^9}, {
   3.781034932390952*^9, 3.781034951120444*^9}, {3.7810350038440857`*^9, 
   3.781035098590438*^9}, {3.7810352274130125`*^9, 3.78103523335223*^9}, {
   3.7810352827844286`*^9, 3.781035286528121*^9}, {3.781035475331958*^9, 
   3.781035586021369*^9}, {3.7812147226286974`*^9, 3.7812147394289455`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Population and Facility Generation", "Section",
 CellChangeTimes->{{3.7809435049718604`*^9, 3.7809435119808617`*^9}, {
  3.7809436047470207`*^9, 3.780943609788619*^9}}],

Cell["\<\
This section adds population center and facility nodes to the base network \
defined above. The updated map is shown for review.\
\>", "Text",
 CellChangeTimes->{{3.780943614961298*^9, 3.7809436441151314`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Initialize", " ", "data", " ", "structures"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"pcoords", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"population", " ", "center", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pname", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"population", " ", "center", " ", "names"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pval", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"population", " ", "center", " ", "populations"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"pid", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"population", " ", "center", " ", "node", " ", "IDs"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fcoords", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"facility", " ", "coordinates"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fname", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"facility", " ", "names"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fval", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"facility", " ", "quality", " ", "metrics"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"fid", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"facility", " ", "node", " ", "IDs"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"anew", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "population", " ", "and", " ", "facility", " ", "walking", " ", "arcs"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"anewcost", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"costs", " ", "of", " ", "new", " ", "walking", " ", "arcs"}], 
    " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Generate", " ", "population", " ", "centers"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"p", "=", "0"}], ",", "c", ",", "accept", ",", 
        RowBox[{"fails", "=", "0"}], ",", 
        RowBox[{"cutoff", "=", "500"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pid", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "ncoords", "]"}], "+", "i"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "populations"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"generate", " ", "node", " ", "IDs"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{"p", "<", "populations"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"try", " ", "placing", " ", "population", " ", "centers"}],
            ",", " ", 
           RowBox[{"but", " ", "repeat", " ", "if", " ", 
            RowBox[{"it", "'"}], "s", " ", "too", " ", "close", " ", "to", 
            " ", "an", " ", "existing", " ", "center"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"accept", "=", "True"}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"whether", " ", "to", " ", "accept", " ", "candidate"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"c", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"RandomReal", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"vlines", "-", "1"}], ")"}], "vgap"}], "]"}], ",", 
             RowBox[{"RandomReal", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"hlines", "-", "1"}], ")"}], "hgap"}], "]"}]}], 
            "}"}]}], ";", 
          RowBox[{"(*", " ", "candidate", " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"fails", "\[LessEqual]", "cutoff"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "only", " ", "bother", " ", "with", " ", "the", " ", "closeness",
               " ", "check", " ", "if", " ", "we", " ", 
              RowBox[{"haven", "'"}], "t", " ", "seen", " ", "too", " ", 
              "many", " ", "failures", " ", "so", " ", "far"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "check", " ", "distance", " ", "to", " ", "all", " ", 
                "accepted", " ", "population", " ", "centers"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"EuclideanDistance", "[", 
                   RowBox[{"c", ",", 
                    RowBox[{"pcoords", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "<", 
                  "popspace"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"accept", "=", "False"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                   "reject", " ", "candidate", " ", "for", " ", "being", " ", 
                    "too", " ", "close"}], " ", "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"fails", "+=", "1"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{"increment", " ", "fail", " ", "count"}], " ", 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{"Break", "[", "]"}], ";"}]}], 
                RowBox[{"(*", " ", 
                 RowBox[{"break", " ", "if", " ", "too", " ", "close"}], " ", 
                 "*)"}], "\[IndentingNewLine]", "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "pcoords", "]"}]}], "}"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"accept", "\[Equal]", "True"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "add", " ", "accepted", " ", "candidate", " ", "to", " ", 
              "list"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pcoords", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"pcoords", ",", "c"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"p", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"pname", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<Pop\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"i", "-", "1"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "populations"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"names", " ", "of", " ", "population", " ", "centers"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pval", "=", 
        RowBox[{"RandomInteger", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"minpop", ",", "maxpop"}], "}"}], ",", "populations"}], 
         "]"}]}], ";"}]}], 
     RowBox[{"(*", " ", 
      RowBox[{"randomize", " ", "populations"}], " ", "*)"}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Generate", " ", "facilities"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fid", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "ncoords", "]"}], "+", "populations", "+", 
           "i"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "facilities"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"generate", " ", "node", " ", "IDs"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"fcoords", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"vlines", "-", "1"}], ")"}], " ", "vgap"}], ",", 
             "facilities"}], "]"}], ",", 
           RowBox[{"RandomReal", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"hlines", "-", "1"}], ")"}], " ", "hgap"}], ",", 
             "facilities"}], "]"}]}], "}"}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"randomized", " ", "coordinates"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"fname", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"\"\<Fac\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"i", "-", "1"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "facilities"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"names", " ", "of", " ", "facilities"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"fval", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"1", ",", "facilities"}], "]"}]}], ";"}]}], 
     RowBox[{"(*", " ", 
      RowBox[{"constant", " ", "value"}], " ", "*)"}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Generate", " ", "additional", " ", "walking", " ", "arcs"}], " ",
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "nbhd", ",", "a", ",", "b", ",", "blist", ",", "temp", ",", "d", ",", 
        "t"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "population", " ", "center", " ", "and",
           " ", "attach", " ", "it", " ", "to", " ", "its", " ", "nearest", 
          " ", "few", " ", "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"pid", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"current", " ", "node"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"nbhd", "=", 
           RowBox[{"Nearest", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"ncoords", "[", 
                RowBox[{"[", "stops", "]"}], "]"}], ",", 
               RowBox[{"pcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"i", "-", "1"}]}], "]"}], "]"}], ",", 
               RowBox[{"pcoords", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}], ",", 
               "fcoords"}], "]"}], ",", 
             RowBox[{"pcoords", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"wneighbors", ",", "wradius2"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "set", " ", "of", " ", "nearby", " ", "stop", " ", "coordinates"}],
            " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "nbhd", "]"}], "\[Equal]", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"report", " ", "isolated", " ", "nodes"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<Stranded node.\>\"", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "generate", " ", "walking", " ", "arcs", " ", "between", " ", 
            "the", " ", "current", " ", "node", " ", "and", " ", "its", " ", 
            "chosen", " ", "neighbors"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "find", " ", "IDs", " ", "corresponding", " ", "to", " ", 
             "coordinate"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"d", "=", 
              RowBox[{"ManhattanDistance", "[", 
               RowBox[{
                RowBox[{"pcoords", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"nbhd", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{"N", "[", 
               RowBox[{"d", "/", "wspeed"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"blist", "=", 
              RowBox[{"{", "}"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "list", " ", "of", " ", "node", " ", "IDs", " ", "that", " ", 
               "match", " ", "the", " ", "current", " ", "coordinate"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"temp", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"ncoords", "[", 
                  RowBox[{"[", "stops", "]"}], "]"}], ",", 
                 RowBox[{"nbhd", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "temp", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"blist", "=", "temp"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"temp", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{"pcoords", ",", 
                 RowBox[{"nbhd", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "temp", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"blist", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"blist", ",", 
                   RowBox[{"temp", "+", 
                    RowBox[{"Length", "[", "ncoords", "]"}]}]}], "]"}]}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"temp", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{"fcoords", ",", 
                 RowBox[{"nbhd", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "temp", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"blist", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"blist", ",", 
                   RowBox[{"temp", "+", "populations", "+", 
                    RowBox[{"Length", "[", "ncoords", "]"}]}]}], "]"}]}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "generate", " ", "walking", " ", "arcs", " ", "to", " ", "all", 
               " ", "chosen", " ", "IDs"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"b", "=", 
                 RowBox[{"blist", "[", 
                  RowBox[{"[", "k", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"anew", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"anew", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"a", "\[DirectedEdge]", "b"}], ",", 
                    RowBox[{"b", "\[DirectedEdge]", "a"}]}], "}"}]}], "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"anewcost", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"anewcost", ",", 
                   RowBox[{"{", 
                    RowBox[{"t", ",", "t"}], "}"}]}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", "blist", "]"}]}], "}"}]}], "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "nbhd", "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "pcoords", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "facility", " ", "and", " ", "attach", 
          " ", "it", " ", "to", " ", "its", " ", "nearest", " ", "few", " ", 
          "nodes"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"a", "=", 
           RowBox[{"fid", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"current", " ", "node"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"nbhd", "=", 
           RowBox[{"Nearest", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"ncoords", "[", 
                RowBox[{"[", "stops", "]"}], "]"}], ",", 
               RowBox[{"fcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"i", "-", "1"}]}], "]"}], "]"}], ",", 
               RowBox[{"fcoords", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"i", "+", "1"}], ";;"}], "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"fcoords", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"wneighbors", ",", "wradius2"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "set", " ", "of", " ", "nearby", " ", "stop", " ", "coordinates"}],
            " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "nbhd", "]"}], "\[Equal]", "0"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"report", " ", "isolated", " ", "nodes"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<Stranded node.\>\"", "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "generate", " ", "walking", " ", "arcs", " ", "between", " ", 
            "the", " ", "current", " ", "node", " ", "and", " ", "its", " ", 
            "chosen", " ", "neighbors"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "find", " ", "IDs", " ", "corresponding", " ", "to", " ", 
             "coordinate"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"d", "=", 
              RowBox[{"ManhattanDistance", "[", 
               RowBox[{
                RowBox[{"fcoords", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"nbhd", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{"N", "[", 
               RowBox[{"d", "/", "wspeed"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"blist", "=", 
              RowBox[{"{", "}"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{
              "list", " ", "of", " ", "node", " ", "IDs", " ", "that", " ", 
               "match", " ", "the", " ", "current", " ", "coordinate"}], " ", 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"temp", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{"ncoords", "[", 
                  RowBox[{"[", "stops", "]"}], "]"}], ",", 
                 RowBox[{"nbhd", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "temp", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"blist", "=", "temp"}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"temp", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{"fcoords", ",", 
                 RowBox[{"nbhd", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "temp", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"blist", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"blist", ",", 
                   RowBox[{"temp", "+", "populations", "+", 
                    RowBox[{"Length", "[", "ncoords", "]"}]}]}], "]"}]}], 
                ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
              "generate", " ", "walking", " ", "arcs", " ", "to", " ", "all", 
               " ", "chosen", " ", "IDs"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"b", "=", 
                 RowBox[{"blist", "[", 
                  RowBox[{"[", "k", "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"anew", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"anew", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"a", "\[DirectedEdge]", "b"}], ",", 
                    RowBox[{"b", "\[DirectedEdge]", "a"}]}], "}"}]}], "]"}]}],
                 ";", "\[IndentingNewLine]", 
                RowBox[{"anewcost", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"anewcost", ",", 
                   RowBox[{"{", 
                    RowBox[{"t", ",", "t"}], "}"}]}], "]"}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", "blist", "]"}]}], "}"}]}], "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "nbhd", "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "fcoords", "]"}]}], "}"}]}], "]"}], ";"}]}],
      "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Problem", " ", "size", " ", "statistics"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Total nodes: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{"Length", "[", "ncoords", "]"}], "+", "populations", "+", 
        "facilities"}], "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"\"\<Total arcs: \>\"", "<>", 
      RowBox[{"ToString", "[", 
       RowBox[{
        RowBox[{"Length", "[", "arcs", "]"}], "+", 
        RowBox[{"Length", "[", "anew", "]"}]}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Display", " ", "map", " ", "for", " ", "review"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"as", "=", 
       RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
         "pick", " ", "subset", " ", "of", " ", "arcs", " ", "that", " ", 
          "are", " ", "not", " ", "boarding", " ", "or", " ", "alighting"}], 
         ",", " ", 
         RowBox[{
         "since", " ", "otherwise", " ", "Mathematica", " ", "will", " ", 
          "have", " ", "trouble", " ", "drawing", " ", "things"}]}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"atype", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "1"}], "&&", 
           RowBox[{
            RowBox[{"atype", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "2"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"as", "=", 
            RowBox[{"Append", "[", 
             RowBox[{"as", ",", 
              RowBox[{"arcs", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "arcs", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Show", "[", 
       RowBox[{
        RowBox[{"GraphPlot", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{
                 RowBox[{"Length", "[", "ncoords", "]"}], "+", 
                 RowBox[{"Length", "[", "pcoords", "]"}], "+", 
                 RowBox[{"Length", "[", "fcoords", "]"}]}]}], "}"}]}], "]"}], 
            ",", "anew", ",", 
            RowBox[{"VertexCoordinates", "\[Rule]", 
             RowBox[{"Join", "[", 
              RowBox[{"ncoords", ",", "pcoords", ",", "fcoords"}], "]"}]}]}], 
           "]"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", "Gray", "}"}]}], ",", 
          RowBox[{"DirectedEdges", "\[Rule]", "False"}]}], "]"}], ",", 
        RowBox[{"GraphPlot", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}], 
            ",", "as", ",", 
            RowBox[{"VertexCoordinates", "\[Rule]", "ncoords"}]}], "]"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", "LightGray", "}"}]}], ",", 
          RowBox[{"DirectedEdges", "\[Rule]", "False"}]}], "]"}], ",", 
        RowBox[{"GraphPlot", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "populations"}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"VertexCoordinates", "\[Rule]", "pcoords"}]}], "]"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Red", ",", 
             RowBox[{"PointSize", "[", "Large", "]"}]}], "}"}]}]}], "]"}], 
        ",", 
        RowBox[{"GraphPlot", "[", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "facilities"}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", "}"}], ",", 
            RowBox[{"VertexCoordinates", "\[Rule]", "fcoords"}]}], "]"}], ",", 
          RowBox[{"PlotStyle", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"Blue", ",", 
             RowBox[{"PointSize", "[", "Medium", "]"}]}], "}"}]}]}], "]"}]}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.7809438158232875`*^9, 3.780943861966584*^9}, {
   3.780943891997198*^9, 3.7809438926701417`*^9}, {3.780944065156047*^9, 
   3.780944102391276*^9}, {3.7809441727515545`*^9, 3.7809442235979967`*^9}, {
   3.7809443796805663`*^9, 3.780944522247503*^9}, {3.7809445533935294`*^9, 
   3.78094492959723*^9}, {3.7809449785343976`*^9, 3.7809450446810045`*^9}, {
   3.780945086511774*^9, 3.780945217779659*^9}, {3.780954980085264*^9, 
   3.780955401635228*^9}, {3.7809554328156857`*^9, 3.7809554838120604`*^9}, {
   3.780955514820426*^9, 3.7809555616554084`*^9}, {3.780955613293849*^9, 
   3.7809556411619124`*^9}, {3.7809557771982903`*^9, 3.780955785276702*^9}, {
   3.7809559467219305`*^9, 3.780955951604385*^9}, {3.7809570673336115`*^9, 
   3.780957129791168*^9}, {3.780957294145226*^9, 3.780957529171463*^9}, {
   3.7809575719734983`*^9, 3.780957665733843*^9}, {3.7809578456988497`*^9, 
   3.780958004008697*^9}, {3.7809581038563623`*^9, 3.780958105755971*^9}, {
   3.780958137274639*^9, 3.780958165306671*^9}, {3.7809581961687546`*^9, 
   3.780958364878252*^9}, {3.7809584049392276`*^9, 3.78095851926123*^9}, {
   3.780958585820965*^9, 3.7809585882536316`*^9}, {3.7809588497243605`*^9, 
   3.780958866829237*^9}, {3.7809589066195326`*^9, 3.7809589140723047`*^9}, {
   3.7809589527378273`*^9, 3.780959135197587*^9}, {3.7809592175477037`*^9, 
   3.780959219031228*^9}, {3.780959307666021*^9, 3.7809593372851996`*^9}, {
   3.7809593948717365`*^9, 3.7809594271989183`*^9}, {3.780959467233106*^9, 
   3.7809596557814617`*^9}, {3.7809597382137775`*^9, 3.780959747291787*^9}, {
   3.780959870689951*^9, 3.780959907848036*^9}, {3.780959941709177*^9, 
   3.7809599879293575`*^9}, {3.78096010730202*^9, 3.7809602095632195`*^9}, 
   3.781034150877735*^9, {3.7810345007561884`*^9, 3.7810345012425303`*^9}, {
   3.781034533931089*^9, 3.781034555981634*^9}, {3.7810360196111317`*^9, 
   3.781036019949006*^9}, {3.7812145999481688`*^9, 3.781214682959031*^9}, {
   3.7812147504175797`*^9, 3.7812147560710716`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Travel Demand and Fleet Size", "Section",
 CellChangeTimes->{{3.7809602831172657`*^9, 3.780960295985717*^9}}],

Cell["\<\
The following section generates travel demand (based on population and an \
assumed gamma distribution of trip lengths) and uses this to assign initial \
fleet sizes.\
\>", "Text",
 CellChangeTimes->{{3.7809602992184343`*^9, 3.7809603410326443`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Initialize", " ", "data", " ", "structures"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"g", "=", 
     RowBox[{"Graph", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{
            RowBox[{"Length", "[", "ncoords", "]"}], "+", "populations", "+", 
            "facilities"}]}], "}"}]}], "]"}], ",", 
       RowBox[{"Join", "[", 
        RowBox[{"arcs", ",", "anew"}], "]"}], ",", 
       RowBox[{"EdgeWeight", "\[Rule]", 
        RowBox[{"Join", "[", 
         RowBox[{"acost", ",", "anewcost"}], "]"}]}]}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "weighted", " ", "graph", " ", "object", " ", "of", " ", "entire", " ", 
     "network"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"od", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Length", "[", "stops", "]"}], ",", 
         RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"full", " ", "OD", " ", "matrix"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"dist", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"N", "[", 
        RowBox[{
         RowBox[{"ManhattanDistance", "[", 
          RowBox[{
           RowBox[{"ncoords", "[", 
            RowBox[{"[", 
             RowBox[{"(", 
              RowBox[{"stops", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], "]"}], ",", 
           RowBox[{"ncoords", "[", 
            RowBox[{"[", 
             RowBox[{"(", 
              RowBox[{"stops", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ")"}], "]"}], "]"}]}], "]"}], 
         "/", 
         RowBox[{"Mean", "[", 
          RowBox[{"{", 
           RowBox[{"minbspeed", ",", "maxbspeed"}], "}"}], "]"}]}], "]"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", 
         RowBox[{"Length", "[", "stops", "]"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "pairwise", " ", "travel", " ", "time", " ", "estimates", " ", "between", 
     " ", "each", " ", "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"popstop", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "populations"}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "lists", " ", "of", " ", "stop", " ", "IDs", " ", 
     "associated", " ", "with", " ", "each", " ", "population", " ", 
     "center"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"svol", "=", 
     RowBox[{"ConstantArray", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Length", "[", "stops", "]"}]}], "]"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"source", " ", "volume", " ", "of", " ", "each", " ", "stop"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"linefleet", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "list", " ", "of", " ", "fleet", " ", "sizes", " ", "for", " ", "each", 
     " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"freq", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"line", " ", "frequencies"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cap", "=", 
     RowBox[{"{", "}"}]}], ";"}], 
   RowBox[{"(*", " ", 
    RowBox[{"daily", " ", "line", " ", "capacities"}], " ", "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Assign", " ", "each", " ", "stop", " ", "to", " ", "its", " ", "nearest",
      " ", "population", " ", "center", " ", "and", " ", "distribute", " ", 
     "population", " ", "as", " ", "travel", " ", "demand"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "pop"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "stop", " ", "to", " ", "find", " ", 
          "the", " ", "nearest", " ", "population", " ", "center"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "=", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"pcoords", ",", 
              RowBox[{
               RowBox[{"Nearest", "[", 
                RowBox[{"pcoords", ",", 
                 RowBox[{"ncoords", "[", 
                  RowBox[{"[", 
                   RowBox[{"(", 
                    RowBox[{"stops", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], "]"}]}], 
                "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"popstop", "[", 
            RowBox[{"[", "p", "]"}], "]"}], "=", 
           RowBox[{"Append", "[", 
            RowBox[{
             RowBox[{"popstop", "[", 
              RowBox[{"[", "p", "]"}], "]"}], ",", 
             RowBox[{"stops", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"divide", " ", "each", " ", "population", " ", 
          RowBox[{"center", "'"}], "s", " ", "population", " ", "among", " ", 
          "its", " ", "associated", " ", "stops"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"pop", "=", 
           RowBox[{"Floor", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"popfrac", " ", 
               RowBox[{"pval", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ")"}], "/", 
             RowBox[{"Length", "[", 
              RowBox[{"popstop", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "population", " ", "to", " ", "assign", " ", "to", " ", "each", 
            " ", "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "assign", " ", "population", " ", "to", " ", "the", " ", "stop"}],
             " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"svol", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"popstop", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], ")"}], "]"}], "]"}], 
             "=", "pop"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"popstop", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "populations"}], "}"}]}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Assign", " ", "source", " ", "demand", " ", "at", " ", "each", " ", 
     "stop", " ", "to", " ", "every", " ", "other", " ", "stop", " ", 
     "according", " ", "to", " ", "the", " ", "gamma", " ", "distribution"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"wt", ",", "vol"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "process", " ", "each", " ", "stop", " ", "and", " ", "evaluate", 
          " ", "the", " ", "gamma", " ", "distribution", " ", "for", " ", 
          "its", " ", "distance", " ", "to", " ", "every", " ", "other", " ", 
          "stop"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"wt", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"gamma", "[", 
              RowBox[{"dist", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "list", " ", "of", " ", "gamma", " ", "distribution", " ", 
            "weights"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"wt", "=", 
           RowBox[{"N", "[", 
            RowBox[{"wt", "/", 
             RowBox[{"Total", "[", "wt", "]"}]}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"normalize", " ", "weights"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"vol", "=", 
           RowBox[{"Round", "[", 
            RowBox[{
             RowBox[{"svol", "[", 
              RowBox[{"[", "i", "]"}], "]"}], " ", "wt"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"split", " ", "volume"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "add", " ", "noise", " ", "to", " ", "each", " ", "volume", " ", 
             "and", " ", "cut", " ", "off", " ", "if", " ", "too", " ", 
             "low"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"vol", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "\[GreaterEqual]", 
               "odfloor"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"vol", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "+=", 
                RowBox[{"RandomInteger", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "odjiggle"}], ",", "odjiggle"}], "}"}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"vol", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "<", "odfloor"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"vol", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "=", "0"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"vol", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", "0"}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "always", " ", "have", " ", "zero", " ", "travel", " ", "demand", 
            " ", "to", " ", "self"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"od", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", "vol"}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "store", " ", "results", " ", "in", " ", "the", " ", "OD", " ", 
           "matrix"}], " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Generate", " ", "shortest", " ", "paths", " ", "between", " ", "each", 
     " ", "OD", " ", "pair", " ", "to", " ", "estimate", " ", "the", " ", 
     "demand", " ", "of", " ", "each", " ", "route"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"s", ",", "t", ",", "npath", ",", "rawvol", ",", "lm", ",", 
        RowBox[{"linevol", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rawvol", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "ncoords", "]"}], "+", "populations", "+",
              "facilities"}], ",", 
            RowBox[{
             RowBox[{"Length", "[", "ncoords", "]"}], "+", "populations", "+",
              "facilities"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "tally", " ", "of", " ", "travel", " ", "volume", " ", "between", " ",
          "every", " ", "possible", " ", "node", " ", "pair"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"s", "=", 
           RowBox[{"stops", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", 
          RowBox[{"(*", " ", "origin", " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"t", "=", 
              RowBox[{"stops", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", "destination", " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"od", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "only", " ", "consider", " ", "pairs", " ", "with", " ", 
                 "nonzero", " ", "travel", " ", "demand"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"npath", "=", 
                 RowBox[{"FindShortestPath", "[", 
                  RowBox[{"g", ",", "s", ",", "t"}], "]"}]}], ";", 
                RowBox[{"(*", " ", 
                 RowBox[{"nodes", " ", "traversed"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"Do", "[", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                  "tally", " ", "the", " ", "volume", " ", "through", " ", 
                   "each", " ", "arc", " ", "in", " ", "the", " ", "path"}], 
                  " ", "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rawvol", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"npath", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ")"}], ",", 
                    RowBox[{"(", 
                    RowBox[{"npath", "[", 
                    RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], ")"}]}], "]"}], 
                    "]"}], "+=", 
                   RowBox[{"od", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "1", ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "npath", "]"}], "-", "1"}]}], 
                   "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"lm", "=", "0"}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{
           "maximum", " ", "travel", " ", "demand", " ", "of", " ", "any", 
            " ", "arc", " ", "on", " ", "the", " ", "current", " ", "line"}], 
           " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "go", " ", "through", " ", "each", " ", "line", " ", "arc", " ", 
             "and", " ", "find", " ", "the", " ", "maximum", " ", "travel", 
             " ", "demand"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"s", "=", 
              RowBox[{"alines", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j", ",", "1"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"arc", " ", "tail"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"t", "=", 
              RowBox[{"alines", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j", ",", "2"}], "]"}], "]"}]}], ";", 
             RowBox[{"(*", " ", 
              RowBox[{"arc", " ", "head"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"lm", "=", 
              RowBox[{"Max", "[", 
               RowBox[{"lm", ",", 
                RowBox[{"rawvol", "[", 
                 RowBox[{"[", 
                  RowBox[{"s", ",", "t"}], "]"}], "]"}]}], "]"}]}]}], ",", 
            RowBox[{"(*", " ", 
             RowBox[{
             "adjust", " ", "maximum", " ", "observed", " ", "volume"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"(", 
                RowBox[{"alines", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}]}], "}"}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"linevol", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"linevol", ",", "lm"}], "]"}]}]}], 
         RowBox[{"(*", " ", 
          RowBox[{
          "save", " ", "maximum", " ", "volume", " ", "of", " ", "line"}], 
          " ", "*)"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "alines", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "assign", " ", "vehicles", " ", "to", " ", "each", " ", "route"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"linefleet", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"bfleet", " ", "linevol"}], ")"}], "/", 
          RowBox[{"Total", "[", "linevol", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", "linefleet", "]"}], "\[NotEqual]", "bfleet"}],
          ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "correct", " ", "rounding", " ", "errors", " ", "to", " ", 
           "achieve", " ", "correct", " ", "fleet", " ", "size"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Total", "[", "linefleet", "]"}], ">", "bfleet"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"if", " ", "too", " ", "many"}], ",", " ", 
              RowBox[{"randomly", " ", "remove", " ", "one"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"linefleet", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"RandomInteger", "[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"Length", "[", "linefleet", "]"}]}], "}"}], "]"}], 
                ")"}], "]"}], "]"}], "-=", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"if", " ", "too", " ", "few"}], ",", " ", 
              RowBox[{"randomly", " ", "add", " ", "one"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"linefleet", "[", 
               RowBox[{"[", 
                RowBox[{"(", 
                 RowBox[{"RandomInteger", "[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"Length", "[", "linefleet", "]"}]}], "}"}], "]"}],
                  ")"}], "]"}], "]"}], "+=", "1"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Maximum fleet: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Max", "[", "linefleet", "]"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Minimum fleet: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Min", "[", "linefleet", "]"}], "]"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Display", " ", "results"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"circ", ",", "tot", ",", "lf"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"system", " ", "load"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"circ", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"(", 
            RowBox[{"linecost", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ")"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "linecost", "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"total", " ", "circuit", " ", "times"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"freq", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{
            RowBox[{"linefleet", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "/", 
            RowBox[{"circ", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "linecost", "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"line", " ", "frequencies"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"cap", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"N", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"freq", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "horizon", " ", "bseats"}], 
            ")"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "linecost", "]"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{"daily", " ", "line", " ", "capacities"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"tot", "=", 
        RowBox[{"Total", "[", "cap", "]"}]}], ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "total", " ", "number", " ", "of", " ", "people", " ", "that", " ", 
         "the", " ", "system", " ", "can", " ", "service"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"lf", "=", 
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "od", "]"}], "]"}], "/", "tot"}], "]"}]}], 
       ";", 
       RowBox[{"(*", " ", 
        RowBox[{
        "average", " ", "load", " ", "factor", " ", "of", " ", "system"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<System Demand: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "od", "]"}], "]"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<System Capacity: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{"Round", "[", "tot", "]"}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<System Load Factor: \>\"", "<>", 
         RowBox[{"ToString", "[", "lf", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Nonzero OD Pairs: \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"Length", "[", "stops", "]"}], "2"], "-", 
           RowBox[{"Count", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", "od", "]"}], ",", "0"}], "]"}]}], 
          "]"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Plot", "[", 
    RowBox[{
     RowBox[{"gamma", "[", "x", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0", ",", 
       RowBox[{"3", "tripmean"}]}], "}"}]}], "]"}], 
   RowBox[{"(*", " ", 
    RowBox[{"gamma", " ", "distribution"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"fun", ",", 
        RowBox[{"as", "=", 
         RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Voronoi", " ", "diagram", " ", "of", " ", "population", " ", 
        "centers"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"atype", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "1"}], "&&", 
            RowBox[{
             RowBox[{"atype", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "\[NotEqual]", "2"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"as", "=", 
             RowBox[{"Append", "[", 
              RowBox[{"as", ",", 
               RowBox[{"arcs", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "arcs", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fun", "=", 
        RowBox[{"Nearest", "[", "pcoords", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"DensityPlot", "[", 
           RowBox[{
            RowBox[{"First", "[", 
             RowBox[{"fun", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "0", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"vlines", "-", "1"}], ")"}], "vgap"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"y", ",", "0", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"hlines", "-", "1"}], ")"}], "hgap"}]}], "}"}], ",", 
            RowBox[{"PlotPoints", "\[Rule]", "80"}], ",", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}]}], "]"}], 
          ",", 
          RowBox[{"GraphPlot", "[", 
           RowBox[{
            RowBox[{"Graph", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}], 
              ",", "as", ",", 
              RowBox[{"VertexCoordinates", "\[Rule]", "ncoords"}]}], "]"}], 
            ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"Black", ",", 
               RowBox[{"Opacity", "[", "0.25", "]"}]}], "}"}]}], ",", 
            RowBox[{"DirectedEdges", "\[Rule]", "False"}]}], "]"}], ",", 
          RowBox[{"Graphics", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "[", "Large", "]"}], ",", 
             RowBox[{"Point", "[", "pcoords", "]"}]}], "}"}], "]"}]}], "]"}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Histogram", "[", 
    RowBox[{"Flatten", "[", "od", "]"}], "]"}], 
   RowBox[{"(*", " ", 
    RowBox[{
    "histogram", " ", "of", " ", "travel", " ", "demand", " ", 
     "frequencies"}], " ", "*)"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJwd0Hkw1GEYB3DXrFpqoiUhMq2bCZFrZqNBch/lpmUc5RyzgxRZU46odKi2
0JKwO45cUaI2mphOExXlGmXknsoRJf2+7x/PfOaZ53nmmefRCEvwipAQExNz
pAI6CZh2xfqztvHDku7Q+HhlMGTliSKhaX3CNUi/F1UIG+UFtyBz5IAANpVU
NkAHs1dN8Fe3cBnG7eH8hjx7zjpcpG9ilFCKqmiJzZQ5zz4mQaeu6gvwZXl4
ATx3y6IBGpVqi6CJfUU3rB1WG4SzG/LDMC1FZRzqrdpPwnk10RyUcpBegdxJ
WWLY+1nJB5T71KKlYWf/rBx0jOzbAdf/yqjC2x1du6C1zLQGlMidsYLN9M02
0LK21RamcXqcIePEIDHtu/AIZFqF+sPLQxPBcMg8IxTGG1yLgL0PJ0/D4X8z
GbBfpYcLd7vU5JC5EC8e6b96vgrefbQkhOOl/jtbKAVxeUzYGeVnB1llRV7w
vfuNUCh7RiccZo+JoiGvwzcOFmoGcODKjxCiHONvFrSg6VaQOju4GrZfTyeG
r5W3Qakyt6ewr03uDdkfE0sM4i98JPvLYwdhD+2r9SNK7ZIaJyhga/tDRnEd
sf2szTG4oegRAb08lGOgS4AwEcpnslPgpXf2WVC1gZsPxS0eEwPYVo1QYtqp
E7rxed3QUmdqDP4ZSJiAow4Fk1B5y5cZ6FeyMQd9k14vQZ6dtWIb5Sfxvd9g
Xtn0BDzjojYPTfmGxGzlUNnHuGerqyZUFefowm3CKEPI7NQwgWl13vug0qin
Ocy4KMaC8SHb/eBRfX3i4RaTMEgr5ydAo7d/kmCpjEIydFtY5sPWetc6uKh+
sxm2TPQ9h9n7uVMw8H4V8cVl7hL0sGaswikl1p52ys/iWlrQ0YpuAPuLG0yh
3pX4Q9A418wZeozc9oRuhqneJI/t9YPpB/uJRRJPouBP1moiLEympcA7O11S
4cl0wxwY+CmTGOTj86GDMlZgOgCNo/tclQyo/x5me0L62HggzF9bC4anMuqT
YaG6Qjr8D9z5PEk=
  "]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Objective Topology", "Section",
 CellChangeTimes->{{3.7809624913336525`*^9, 3.780962498586327*^9}}],

Cell["\<\
The section below randomly selects pairs of transit lines, adjusts both of \
their fleet sizes within ranges around their initial values, and displays \
tables of the objective value with respect to the two decision variables. \
Ideally we would like to see a rough response.\
\>", "Text",
 CellChangeTimes->{{3.7809625026160355`*^9, 3.780962565935731*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"Work", " ", "in", " ", 
     RowBox[{"progress", ".", "\[IndentingNewLine]", "This"}], " ", "can", 
     " ", "either", " ", "consist", " ", "of", " ", "generating", " ", "2", 
     "D", " ", "arrays", " ", "of", " ", "pairs", " ", "of", " ", "fleet", 
     " ", "sizes", " ", "being", " ", "altered"}], ",", " ", 
    RowBox[{
    "or", " ", "just", " ", "single", " ", "fleets", " ", "if", " ", "that", 
     " ", "is", " ", "taking", " ", "too", " ", 
     RowBox[{"long", "."}]}]}], " ", "*)"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7809625730064435`*^9, 3.780962574977812*^9}, {
  3.781038286038891*^9, 3.78103832154051*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["File Export", "Section",
 CellChangeTimes->{{3.7809626146101227`*^9, 3.7809626162315845`*^9}}],

Cell["\<\
If all of the above tests are to the user\[CloseCurlyQuote]s liking, the \
following section can be used to export the full set of example network \
files, plus an additional node coordinate file for use in drawing the network.\
\>", "Text",
 CellChangeTimes->{{3.7809626206251726`*^9, 3.7809626535056324`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Set", " ", "directory"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SetDirectory", "[", 
     RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Arc", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "tab", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"comment", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "\"\<ID\>\"", ",", "\"\<Type\>\"", ",", "\"\<Line\>\"", ",", 
           "\"\<Tail\>\"", ",", "\"\<Head\>\"", ",", "\"\<Time\>\""}], "}"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "fields", " ", "for", " ", "core", " ", "arc", " ", 
          "set"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tab", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"tab", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", 
              RowBox[{"atype", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"alid", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
              RowBox[{
               RowBox[{"arcs", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "-", "1"}], ",", 
              RowBox[{
               RowBox[{"arcs", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}], "-", "1"}], ",", 
              RowBox[{"acost", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "arcs", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"add", " ", "fields", " ", "for", " ", 
          RowBox[{"pop", "/", "fac"}], " ", "arc", " ", "set"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tab", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"tab", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "arcs", "]"}], "+", "i", "-", "1"}], 
              ",", "4", ",", 
              RowBox[{"-", "1"}], ",", 
              RowBox[{"anew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"anew", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
              RowBox[{"anewcost", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "anew", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"export", " ", "table"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"\"\<arc_data.txt\>\"", ",", "tab", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Node", " ", "data", " ", "and", " ", "node", " ", "coordinates"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tab", ",", "ctab"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"comment", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "\"\<ID\>\"", ",", "\"\<Name\>\"", ",", "\"\<Type\>\"", ",", 
           "\"\<Line\>\"", ",", "\"\<Value\>\""}], "}"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ctab", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{"\"\<ID\>\"", ",", "\"\<x\>\"", ",", "\"\<y\>\""}], "}"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "fields", " ", "for", " ", "core", " ", "node", " ", 
          "set"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"tab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"tab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"nname", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"ntype", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"nline", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "<", "0"}], ",", 
                 RowBox[{"nline", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"nline", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "-", "1"}]}], "]"}], ",", 
               RowBox[{"nval", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ctab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"ctab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"i", "-", "1"}], ",", 
               RowBox[{"ncoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"ncoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "ncoords", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "fields", " ", "for", " ", "population", " ", "nodes"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"tab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"tab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"pid", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
               RowBox[{"pname", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "2", ",", 
               RowBox[{"-", "1"}], ",", 
               RowBox[{"pval", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ctab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"ctab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"pid", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
               RowBox[{"pcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"pcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "populations"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "fields", " ", "for", " ", "facility", " ", "nodes"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"tab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"tab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"fid", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
               RowBox[{"fname", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "3", ",", 
               RowBox[{"-", "1"}], ",", 
               RowBox[{"fval", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ctab", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"ctab", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"fid", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
               RowBox[{"fcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{"fcoords", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "facilities"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"export", " ", "table"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<node_data.txt\>\"", ",", "tab", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<node_coordinates.txt\>\"", ",", "ctab", ",", "\"\<Table\>\"", 
         ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"OD", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"tab", ",", 
        RowBox[{"id", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"comment", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "\"\<ID\>\"", ",", "\"\<Origin\>\"", ",", "\"\<Destination\>\"", 
           ",", "\"\<Volume\>\""}], "}"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "add", " ", "a", " ", "row", " ", "for", " ", "each", " ", 
            "nonzero", " ", "travel", " ", "demand"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"od", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tab", "=", 
               RowBox[{"Append", "[", 
                RowBox[{"tab", ",", 
                 RowBox[{"{", 
                  RowBox[{"id", ",", 
                   RowBox[{
                    RowBox[{"stops", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "-", "1"}], ",", 
                   RowBox[{
                    RowBox[{"stops", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "-", "1"}], ",", 
                   RowBox[{"od", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"id", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "stops", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"export", " ", "table"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{"\"\<od_data.txt\>\"", ",", "tab", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Transit", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "tab", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"comment", " ", "line"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "\"\<ID\>\"", ",", "\"\<Name\>\"", ",", "\"\<Type\>\"", ",", 
           "\"\<Fleet\>\"", ",", "\"\<Circuit\>\"", ",", "\"\<Scaling\>\"", 
           ",", "\"\<LB\>\"", ",", "\"\<UB\>\"", ",", "\"\<Fare\>\"", ",", 
           "\"\<Frequency\>\"", ",", "\"\<Capacity\>\""}], "}"}], "}"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "add", " ", "a", " ", "row", " ", "for", " ", "each", " ", "line"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"tab", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"tab", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"i", "-", "1"}], ",", 
              RowBox[{"\"\<Route\>\"", "<>", 
               RowBox[{"ToString", "[", "i", "]"}]}], ",", "0", ",", 
              RowBox[{"linefleet", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"Total", "[", 
               RowBox[{"linecost", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "\"\<1.0\>\"", 
              ",", "linemin", ",", "linemax", ",", "fare", ",", 
              RowBox[{"freq", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"cap", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "}"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "alines", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"export", " ", "table"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<transit_data.txt\>\"", ",", "tab", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Vehicle", " ", "data"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "tab", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "\"\<Type\>\"", ",", "\"\<Name\>\"", ",", "\"\<UB\>\"", ",", 
            "\"\<Capacity\>\"", ",", "\"\<Cost\>\""}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "\"\<Bus1\>\"", ",", "bmax", ",", "bseats", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"export", " ", "table"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Export", "[", 
        RowBox[{
        "\"\<vehicle_data.txt\>\"", ",", "tab", ",", "\"\<Table\>\"", ",", 
         RowBox[{"\"\<FieldSeparators\>\"", "\[Rule]", "\"\<\\t\>\""}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQnZGhrDNX+42jiWgqmFYo1sjYC6RdF//OBdHrbKcU
gWj/3n9g+uyD+HIQ/VfoeCWI3rxgazOINmdJbgXRVTvl+kC0+67708DqFTbP
BtEsQu7zQTRb7a8VIHqFBtMhEH3jkNJJMN818SyIztC7dRdEV6w99xBEr2J9
8xxE++zseQeiIw5uZd4HpO/UMImC6BnMZ2VB9KaGeCUQzWa2RBdET1svpAei
GfIyjEB0wdl+MG1Qf/LzfiDN4REkdABI98WmS4Joo4NN6iCaZek2QxBt+2C6
OYjOmfE7AER7WTGHg+ht1SFnQfQsLf8LINqMz/IKiO6tugWmy36oPgTRBpE/
X4FoAN/Ir3o=
  "]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{758, 833},
WindowMargins->{{90, Automatic}, {Automatic, 60}},
FrontEndVersion->"10.4 for Microsoft Windows (64-bit) (April 11, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 93, 1, 64, "Chapter"],
Cell[676, 25, 266, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[967, 34, 150, 2, 63, "Section"],
Cell[CellGroupData[{
Cell[1142, 40, 218, 3, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[1385, 47, 616, 9, 58, "SubitemNumbered"],
Cell[2004, 58, 293, 3, 24, "SubitemNumbered"],
Cell[2300, 63, 426, 7, 41, "SubitemNumbered"],
Cell[2729, 72, 448, 8, 24, "SubitemNumbered"]
}, Open  ]],
Cell[3192, 83, 315, 4, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[3532, 91, 463, 7, 24, "SubitemNumbered"],
Cell[3998, 100, 433, 6, 24, "SubitemNumbered"],
Cell[4434, 108, 377, 4, 24, "SubitemNumbered"],
Cell[4814, 114, 456, 7, 24, "SubitemNumbered"]
}, Open  ]],
Cell[5285, 124, 300, 4, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[5610, 132, 408, 7, 41, "SubitemNumbered"],
Cell[6021, 141, 524, 9, 58, "SubitemNumbered"],
Cell[6548, 152, 825, 15, 75, "SubitemNumbered"],
Cell[7376, 169, 680, 10, 58, "SubitemNumbered"]
}, Open  ]],
Cell[8071, 182, 532, 7, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[8628, 193, 625, 9, 41, "SubitemNumbered"],
Cell[9256, 204, 620, 9, 41, "SubitemNumbered"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9937, 220, 99, 1, 63, "Section"],
Cell[10039, 223, 273, 5, 49, "Text"],
Cell[10315, 230, 10405, 213, 952, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20757, 448, 96, 1, 63, "Section"],
Cell[20856, 451, 187, 4, 30, "Text"],
Cell[21046, 457, 750, 23, 60, "Input"],
Cell[21799, 482, 273, 9, 5, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[22121, 497, 94, 1, 64, "Chapter"],
Cell[22218, 500, 328, 6, 49, "Text"],
Cell[CellGroupData[{
Cell[22571, 510, 160, 2, 63, "Section"],
Cell[22734, 514, 340, 6, 49, "Text"],
Cell[23077, 522, 60832, 1407, 5490, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[83946, 1934, 174, 2, 63, "Section"],
Cell[84123, 1938, 220, 4, 49, "Text"],
Cell[84346, 1944, 32087, 751, 3272, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[116470, 2700, 115, 1, 63, "Section"],
Cell[116588, 2703, 260, 5, 49, "Text"],
Cell[116851, 2710, 30888, 754, 2906, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[147776, 3469, 105, 1, 63, "Section"],
Cell[147884, 3472, 367, 6, 68, "Text"],
Cell[148254, 3480, 721, 14, 92, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[149012, 3499, 100, 1, 63, "Section"],
Cell[149115, 3502, 321, 5, 49, "Text"],
Cell[149439, 3509, 17031, 411, 1752, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

