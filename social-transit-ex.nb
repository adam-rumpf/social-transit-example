(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14378,        374]
NotebookOptionsPosition[     12478,        309]
NotebookOutlinePosition[     12821,        324]
CellTagsIndexPosition[     12778,        321]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Preamble", "Chapter",
 CellChangeTimes->{{3.780771541527303*^9, 3.780771547398859*^9}}],

Cell["\<\
This section contains the program\[CloseCurlyQuote]s pseudocode and a few \
definitions that should only need to be executed once (as long as the \
parameters are not changed).\
\>", "Text",
 CellChangeTimes->{{3.780771585873912*^9, 3.780771622034917*^9}}],

Cell[CellGroupData[{

Cell["Pseudocode", "Section",
 CellChangeTimes->{{3.7803292543397837`*^9, 3.780329256110973*^9}, {
  3.7807721136837177`*^9, 3.7807721151272697`*^9}}],

Cell[CellGroupData[{

Cell["Define the road network.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678766351327*^9}}],

Cell[CellGroupData[{

Cell["\<\
The network consists of a square grid of stops, with routes running N/S and \
E/W to define the grid (plus a dummy turnaround loop on each end). We can \
also choose to insert additional stops between the grid intersections.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.7806789159643526`*^9}, {
  3.780681600251603*^9, 3.7806816134123807`*^9}, {3.780682029623898*^9, 
  3.780682038601019*^9}}],

Cell["Each stop is a node, whose coordinates we store.", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.780678938594097*^9}}],

Cell["\<\
We define arcs for each line, with slightly randomized travel times that \
depend on distance plus a constant boarding time.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.780678805404803*^9}, {3.7806789159593525`*^9, 3.780678946325615*^9}, {
  3.780681957166153*^9, 3.780681990746385*^9}}],

Cell["\<\
Each stop is within walking distance of the four stops immediately adjacent, \
with walking times based on taxicab distance.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
  3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
  3.7806788303897915`*^9}, {3.7806789332048225`*^9, 3.780678933210821*^9}, {
  3.780682076815765*^9, 3.780682088783948*^9}}]
}, Open  ]],

Cell["Define population centers and facilities.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806790038531685`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Population centers are somewhat uniformly distributed, and each has \
coordinates and a population.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.780679059001484*^9}}],

Cell["Facilities are somewhat clustered near the center.", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.780679061739606*^9}}],

Cell["\<\
All population centers and facilities receive walking arcs to their nearest \
stops depending on the grid square that they fall into. They can also be \
adjacent to each other if inside the same grid square.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791448949413`*^9}, {3.7806868399016275`*^9, 3.780686839909628*^9}}]
}, Open  ]],

Cell["Define OD and fleet sizes.", "ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791520776386`*^9}}],

Cell[CellGroupData[{

Cell["\<\
For each stop, decide the travel demand to all other stops according to a \
gamma distribution based on Euclidean distance.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806791963604383`*^9}}],

Cell["\<\
The total outgoing travel demand for a stop should also depend on its \
population. For each stop, determine the nearest population center, and \
equally distribute the center\[CloseCurlyQuote]s population to all of its \
associated stops.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.7806792946319265`*^9}}],

Cell[TextData[{
 "There should also be an overall scaling factor to adjust the daily traffic \
as a fraction of the overall population (my Chicago data shows that the \
number of daily boardings is approximately ",
 Cell[BoxData[
  FormBox[
   RowBox[{"2", "/", "3"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 " of the total population)."
}], "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679686257347*^9}}],

Cell["\<\
The fleet sizes of each route should be proportional to the number of people \
using them, which can be quickly modeled by assuming that all of the travel \
demand travels along its shortest path.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806868545819197`*^9}}]
}, Open  ]],

Cell["Evaluate the objective function\[CloseCurlyQuote]s shape.", \
"ItemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806868700739527`*^9}}],

Cell[CellGroupData[{

Cell["\<\
Pick several pairs of lines at random. For each pair, vary both of the fleet \
sizes within a range and calculate the objective value for each.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.780686940147503*^9}}],

Cell["\<\
Use these results to generate a table of objective values, displayed as an \
array plot, in order to show how rough the objective looks.\
\>", "SubitemNumbered",
 CellChangeTimes->{{3.780329276188409*^9, 3.7803293011823826`*^9}, {
   3.7803296031889906`*^9, 3.7803296394264975`*^9}, {3.780678753422472*^9, 
   3.7806788303897915`*^9}, 3.7806789332048225`*^9, {3.780678964883665*^9, 
   3.78067931417766*^9}, {3.7806796120661387`*^9, 3.780679639303404*^9}, {
   3.7806796862473507`*^9, 3.780679754172571*^9}, {3.7806866365658283`*^9, 
   3.7806866368507576`*^9}, {3.780686854573923*^9, 3.7806869729809537`*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Function Definitions", "Section",
 CellChangeTimes->{{3.7806899010821943`*^9, 3.780689904941957*^9}, {
  3.7807721414859934`*^9, 3.7807721439066253`*^9}}],

Cell["\<\
These are functions required for every execution and should only need to be \
defined once.\
\>", "Text",
 CellChangeTimes->{{3.7806899080889482`*^9, 3.7806899317013764`*^9}, 
   3.780772151246967*^9}],

Cell[BoxData[
 RowBox[{"(*", "**)"}]], "Input",
 CellChangeTimes->{{3.7807714622225385`*^9, 3.780771466775069*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.7807714143939443`*^9, 3.7807714158685155`*^9}}],

Cell["\<\
The parameters defined below can be changed to generate different types of \
example network. Everything below this point should also be re-executed when \
the parameters are updated.\
\>", "Text",
 CellChangeTimes->{{3.780771419110817*^9, 3.780771456481101*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"hlines", "=", "4"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "number", " ", "of", " ", "grid", " ", "lines", " ", "running", " ", 
    "horizontally"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"vlines", "=", "6"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "number", " ", "of", " ", "grid", " ", "lines", " ", "running", " ", 
    "vertically"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hgap", "=", "0.0625"}], ";"}], 
  RowBox[{"(*", " ", 
   RowBox[{"distance", " ", "between", " ", "horizontal", " ", "lines", " ", 
    RowBox[{"(", "mi", ")"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vgap", "=", "0.0625"}], ";", 
  RowBox[{"(*", " ", 
   RowBox[{"distance", " ", "between", " ", "vertical", " ", "lines", " ", 
    RowBox[{"(", "mi", ")"}]}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7807714685817165`*^9, 3.780771469692157*^9}, {
  3.7807722664852037`*^9, 3.7807723285478315`*^9}, {3.7807723622388773`*^9, 
  3.7807724136701546`*^9}}],

Cell[" ", "Text",
 Editable->False,
 Selectable->False,
 CellFrame->{{0, 0}, {0, 0.5}},
 ShowCellBracket->False,
 CellMargins->{{0, 0}, {1, 1}},
 CellElementSpacings->{"CellMinHeight"->1},
 CellFrameMargins->0,
 CellFrameColor->RGBColor[0, 0, 1],
 CellSize->{Inherited, 3}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Execution", "Chapter",
 CellChangeTimes->{{3.780771565651047*^9, 3.780771567477462*^9}}],

Cell["\<\
The contents of the following sections may need to be repeatedly re-executed \
to generate satisfactory example networks.\
\>", "Text",
 CellChangeTimes->{{3.7807716306375384`*^9, 3.780771649293496*^9}}],

Cell[CellGroupData[{

Cell["Network Construction", "Section",
 CellChangeTimes->{{3.780771521038786*^9, 3.7807715235126934`*^9}, {
  3.7807720128307896`*^9, 3.7807720163927107`*^9}}],

Cell["\<\
This section builds the underlying network of stops and other locations, \
along with the line arcs and walking arcs to connect them. A map of the \
network is shown once this process is complete.\
\>", "Text",
 CellChangeTimes->{{3.78077198108607*^9, 3.7807720376299205`*^9}, {
  3.7807720965858326`*^9, 3.7807721011810923`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{759, 833},
WindowMargins->{{94, Automatic}, {Automatic, 62}},
FrontEndVersion->"10.4 for Microsoft Windows (64-bit) (April 11, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 93, 1, 64, "Chapter"],
Cell[676, 25, 266, 5, 49, "Text"],
Cell[CellGroupData[{
Cell[967, 34, 150, 2, 63, "Section"],
Cell[CellGroupData[{
Cell[1142, 40, 218, 3, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[1385, 47, 579, 9, 58, "SubitemNumbered"],
Cell[1967, 58, 293, 3, 24, "SubitemNumbered"],
Cell[2263, 63, 426, 7, 41, "SubitemNumbered"],
Cell[2692, 72, 428, 7, 41, "SubitemNumbered"]
}, Open  ]],
Cell[3135, 82, 315, 4, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[3475, 90, 382, 7, 41, "SubitemNumbered"],
Cell[3860, 99, 325, 4, 24, "SubitemNumbered"],
Cell[4188, 105, 540, 8, 58, "SubitemNumbered"]
}, Open  ]],
Cell[4743, 116, 300, 4, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[5068, 124, 408, 7, 41, "SubitemNumbered"],
Cell[5479, 133, 524, 9, 58, "SubitemNumbered"],
Cell[6006, 144, 721, 14, 58, "SubitemNumbered"],
Cell[6730, 160, 680, 10, 58, "SubitemNumbered"]
}, Open  ]],
Cell[7425, 173, 532, 7, 30, "ItemNumbered"],
Cell[CellGroupData[{
Cell[7982, 184, 625, 9, 41, "SubitemNumbered"],
Cell[8610, 195, 620, 9, 41, "SubitemNumbered"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9291, 211, 160, 2, 63, "Section"],
Cell[9454, 215, 211, 5, 30, "Text"],
Cell[9668, 222, 115, 2, 31, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9820, 229, 99, 1, 63, "Section"],
Cell[9922, 232, 273, 5, 49, "Text"],
Cell[10198, 239, 1089, 28, 112, "Input"],
Cell[11290, 269, 273, 9, 5, "Text"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[11612, 284, 94, 1, 64, "Chapter"],
Cell[11709, 287, 213, 4, 49, "Text"],
Cell[CellGroupData[{
Cell[11947, 295, 160, 2, 63, "Section"],
Cell[12110, 299, 340, 6, 49, "Text"]
}, Open  ]]
}, Open  ]]
}
]
*)

